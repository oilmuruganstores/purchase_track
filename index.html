<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Oil Murugan Stores | Purchase Dashboard</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:"Inter","Segoe UI",system-ui,sans-serif;
    background:linear-gradient(135deg,#0f172a,#1e293b);
}
:root{
    --blue:#3b82f6;
    --green:#22c55e;
    --red:#ef4444;
    --orange:#f59e0b;
    --card:#ffffff;
    --muted:#64748b;
}
.app{max-width:1500px;margin:auto;padding:20px}

/* HEADER */
.header{
    display:flex;justify-content:space-between;align-items:center;
    color:#fff;margin-bottom:20px
}
.header h1{margin:0}

/* TABS */
.tabs{display:flex;gap:12px;margin-bottom:20px}
.tab{
    padding:12px 20px;border-radius:999px;
    background:#334155;color:#fff;cursor:pointer;font-weight:600
}
.tab.active{background:linear-gradient(135deg,#38bdf8,#2563eb)}

/* PANELS */
.panel{display:none;background:#f8fafc;border-radius:20px;padding:20px}
.panel.active{display:block}

/* DASHBOARD */
.dashboard{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:16px;margin-bottom:20px
}
.card{
    background:var(--card);
    border-radius:20px;padding:20px;
    box-shadow:0 15px 40px rgba(0,0,0,.2)
}
.card p{margin:0;color:var(--muted)}
.card h2{margin-top:10px;font-size:28px}

/* FORM */
.form-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:12px;margin-bottom:20px
}
input,button{
    padding:14px;border-radius:12px;
    border:1px solid #e5e7eb;font-size:14px
}
button{
    background:linear-gradient(135deg,#22c55e,#16a34a);
    color:#fff;border:none;font-weight:700;cursor:pointer
}

/* TABLE */
.table-box{background:#fff;border-radius:20px;overflow:hidden}
table{width:100%;border-collapse:collapse}
th{
    background:linear-gradient(135deg,#1e293b,#334155);
    color:#fff;padding:14px;text-align:left
}
td{padding:14px;border-bottom:1px solid #e5e7eb}
tr:hover{background:#f1f5f9}
.edit{color:#2563eb;font-weight:600;cursor:pointer}

/* CONDITIONAL FORMATTING */
.cf-green{background:#dcfce7;color:#166534;font-weight:700;border-radius:10px}
.cf-light-green{background:#ecfdf5;color:#065f46;font-weight:600;border-radius:10px}
.cf-orange{background:#ffedd5;color:#9a3412;font-weight:700;border-radius:10px}
.cf-red{background:#fee2e2;color:#991b1b;font-weight:800;border-radius:10px}

/* FILTER */
.filters{
    display:grid;
    grid-template-columns:1fr 180px 180px auto;
    gap:12px;margin-bottom:15px
}
.reset{background:#e5e7eb;color:#111}

/* CHART */
.chart-box{
    background:#fff;
    border-radius:20px;
    padding:20px;
    margin-bottom:20px;
    box-shadow:0 15px 40px rgba(0,0,0,.15)
}
</style>
</head>

<body>
<div class="app">

<!-- HEADER -->
<div class="header">
    <h1>Oil Murugan Stores</h1>
    <div>ðŸ“Š Purchase Analytics</div>
</div>

<!-- TABS -->
<div class="tabs">
    <div class="tab active" onclick="openTab('today')">Today</div>
    <div class="tab" onclick="openTab('history')">History</div>
    <div class="tab" onclick="openTab('charts')">Charts</div>
</div>

<!-- TODAY -->
<div id="today" class="panel active">

<div class="dashboard">
    <div class="card"><p>Purchase</p><h2 id="dBill">â‚¹0</h2></div>
    <div class="card"><p>Paid</p><h2 id="dPaid">â‚¹0</h2></div>
    <div class="card"><p>Cash</p><h2 id="dCash">â‚¹0</h2></div>
    <div class="card"><p>UPI</p><h2 id="dUpi">â‚¹0</h2></div>
    <div class="card"><p>Pending</p><h2 id="dPending">â‚¹0</h2></div>
</div>

<div class="form-grid">
    <input list="supplierList" id="supplier" placeholder="Agency / Supplier">
    <datalist id="supplierList"></datalist>

    <input id="bill" type="number" placeholder="Bill Amount â‚¹">
    <input id="cash" type="number" placeholder="Cash Paid â‚¹" value="0">
    <input id="upi" type="number" placeholder="UPI Paid â‚¹" value="0">
    <button onclick="saveEntry()">Save</button>
</div>

<div class="table-box">
<table>
<thead>
<tr>
<th>Supplier</th><th>Bill</th><th>Cash</th><th>UPI</th><th>Paid</th><th>Pending</th><th>Edit</th>
</tr>
</thead>
<tbody id="todayRows"></tbody>
</table>
</div>

</div>

<!-- HISTORY -->
<div id="history" class="panel">
<div class="filters">
    <input id="fSupplier" placeholder="Supplier">
    <input id="fromDate" type="date">
    <input id="toDate" type="date">
    <button class="reset" onclick="resetFilters()">Reset</button>
</div>

<div class="table-box">
<table>
<thead>
<tr>
<th>Date</th><th>Supplier</th><th>Bill</th><th>Cash</th><th>UPI</th><th>Paid</th><th>Pending</th>
</tr>
</thead>
<tbody id="historyRows"></tbody>
</table>
</div>
</div>

<!-- CHARTS -->
<div id="charts" class="panel">

<div class="chart-box">
    <h3>ðŸ“… Daily Purchase (Last 7 Days)</h3>
    <canvas id="dailyChart"></canvas>
</div>

<div class="chart-box">
    <h3>ðŸ“Š Cash vs UPI</h3>
    <canvas id="modeChart"></canvas>
</div>

</div>

</div>

<script>
const today = new Date().toISOString().split("T")[0];
let data = JSON.parse(localStorage.getItem("purchase_app")) || [];
let suppliers = JSON.parse(localStorage.getItem("supplier_list")) || [];
let editIndex = null;

function save(){
 localStorage.setItem("purchase_app",JSON.stringify(data));
 localStorage.setItem("supplier_list",JSON.stringify(suppliers));
}

function pendingClass(v){
 if(v===0) return "cf-green";
 if(v<=5000) return "cf-light-green";
 if(v<=20000) return "cf-orange";
 return "cf-red";
}

function saveEntry(){
 let name=supplier.value.trim();
 let entry={supplier:name,bill:+bill.value,cash:+cash.value,upi:+upi.value,date:today};
 if(!name||!entry.bill) return alert("Enter supplier & bill");
 if(entry.cash+entry.upi>entry.bill) return alert("Paid exceeds bill");

 if(!suppliers.includes(name)) suppliers.push(name);
 if(editIndex!==null){data[editIndex]=entry;editIndex=null;}
 else data.push(entry);

 supplier.value=bill.value="";
 cash.value=upi.value=0;
 save();render();
}

function render(){
 todayRows.innerHTML="";
 let tb=0,tp=0,tc=0,tu=0;

 data.filter(e=>e.date===today).forEach((e,i)=>{
  let paid=e.cash+e.upi;
  tb+=e.bill;tp+=paid;tc+=e.cash;tu+=e.upi;

  todayRows.innerHTML+=`
  <tr>
   <td>${e.supplier}</td>
   <td>â‚¹${e.bill}</td>
   <td>â‚¹${e.cash}</td>
   <td>â‚¹${e.upi}</td>
   <td>â‚¹${paid}</td>
   <td class="${pendingClass(e.bill-paid)}">â‚¹${e.bill-paid}</td>
   <td class="edit" onclick="edit(${i})">Edit</td>
  </tr>`;
 });

 dBill.textContent="â‚¹"+tb;
 dPaid.textContent="â‚¹"+tp;
 dCash.textContent="â‚¹"+tc;
 dUpi.textContent="â‚¹"+tu;
 dPending.textContent="â‚¹"+(tb-tp);

 renderHistory();
 renderCharts();
 updateSupplierList();
 save();
}

function renderHistory(){
 historyRows.innerHTML="";
 data.filter(e=>{
  if(fSupplier.value&&!e.supplier.toLowerCase().includes(fSupplier.value.toLowerCase()))return false;
  if(fromDate.value&&e.date<fromDate.value)return false;
  if(toDate.value&&e.date>toDate.value)return false;
  return true;
 }).forEach(e=>{
  let paid=e.cash+e.upi;
  historyRows.innerHTML+=`
  <tr>
   <td>${e.date}</td>
   <td>${e.supplier}</td>
   <td>â‚¹${e.bill}</td>
   <td>â‚¹${e.cash}</td>
   <td>â‚¹${e.upi}</td>
   <td>â‚¹${paid}</td>
   <td class="${pendingClass(e.bill-paid)}">â‚¹${e.bill-paid}</td>
  </tr>`;
 });
}

let dailyChart,modeChart;

function renderCharts(){
 const days=[...Array(7)].map((_,i)=>{
  let d=new Date();d.setDate(d.getDate()-i);
  return d.toISOString().split("T")[0];
 }).reverse();

 let dailyTotals=days.map(d=>data.filter(e=>e.date===d).reduce((s,e)=>s+e.bill,0));
 let cashTotal=data.reduce((s,e)=>s+e.cash,0);
 let upiTotal=data.reduce((s,e)=>s+e.upi,0);

 if(dailyChart) dailyChart.destroy();
 dailyChart=new Chart(document.getElementById("dailyChart"),{
  type:"bar",
  data:{labels:days,datasets:[{label:"â‚¹ Purchase",data:dailyTotals,backgroundColor:"#3b82f6"}]}
 });

 if(modeChart) modeChart.destroy();
 modeChart=new Chart(document.getElementById("modeChart"),{
  type:"doughnut",
  data:{labels:["Cash","UPI"],datasets:[{data:[cashTotal,upiTotal],backgroundColor:["#22c55e","#3b82f6"]}]}
 });
}

function edit(i){
 let e=data[i];
 supplier.value=e.supplier;
 bill.value=e.bill;
 cash.value=e.cash;
 upi.value=e.upi;
 editIndex=i;
}

function updateSupplierList(){
 supplierList.innerHTML="";
 suppliers.forEach(s=>supplierList.innerHTML+=`<option value="${s}">`);
}

function resetFilters(){
 fSupplier.value=fromDate.value=toDate.value="";
 renderHistory();
}

function openTab(id){
 document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
 document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 event.target.classList.add("active");
}

render();
</script>

</body>
</html>
