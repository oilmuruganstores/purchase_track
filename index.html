<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Oil Murugan Stores | Purchase System</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}
body{
 margin:0;
 font-family:"Inter","Segoe UI",system-ui,sans-serif;
 background:linear-gradient(135deg,#0f172a,#1e293b);
}
:root{
 --blue:#3b82f6;
 --green:#22c55e;
 --red:#ef4444;
 --orange:#f59e0b;
 --purple:#8b5cf6;
 --card:#ffffff;
 --muted:#64748b;
}
.app{max-width:1500px;margin:auto;padding:20px}

/* HEADER */
.header{
 display:flex;justify-content:space-between;align-items:center;
 color:#fff;margin-bottom:20px
}

/* TABS */
.tabs{display:flex;gap:12px;margin-bottom:20px}
.tab{
 padding:12px 20px;border-radius:999px;
 background:#334155;color:#fff;
 cursor:pointer;font-weight:600
}
.tab.active{background:linear-gradient(135deg,#38bdf8,#2563eb)}

/* PANELS */
.panel{display:none;background:#f8fafc;border-radius:20px;padding:20px}
.panel.active{display:block}

/* DASHBOARD */
.dashboard{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
 gap:16px;margin-bottom:20px
}
.card{
 background:var(--card);
 border-radius:20px;padding:20px;
 box-shadow:0 15px 40px rgba(0,0,0,.2)
}
.card p{margin:0;color:var(--muted)}
.card h2{margin-top:10px;font-size:26px}

/* FORM */
.form-grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
 gap:12px;margin-bottom:20px
}
input,button{
 padding:14px;border-radius:12px;
 border:1px solid #e5e7eb;font-size:14px
}
button{
 background:linear-gradient(135deg,#22c55e,#16a34a);
 color:#fff;border:none;font-weight:700;cursor:pointer
}

/* TABLE */
.table-box{background:#fff;border-radius:20px;overflow:hidden}
table{width:100%;border-collapse:collapse}
th{
 background:linear-gradient(135deg,#1e293b,#334155);
 color:#fff;padding:14px;text-align:left
}
td{padding:14px;border-bottom:1px solid #e5e7eb}
tr:hover{background:#f1f5f9}

/* CHART */
.chart-box{
 background:#fff;border-radius:20px;
 padding:20px;margin-bottom:20px;
 box-shadow:0 15px 40px rgba(0,0,0,.15)
}

/* CONDITIONAL */
.good{color:var(--green);font-weight:700}
.bad{color:var(--red);font-weight:700}
.warn{color:var(--orange);font-weight:700}
</style>
</head>

<body>
<div class="app">

<div class="header">
 <h1>Oil Murugan Stores</h1>
 <div>Purchase Intelligence System</div>
</div>

<div class="tabs">
 <div class="tab active" onclick="openTab('today')">Today</div>
 <div class="tab" onclick="openTab('history')">History</div>
 <div class="tab" onclick="openTab('analytics')">Analytics</div>
</div>

<!-- TODAY -->
<div id="today" class="panel active">

<div class="dashboard">
 <div class="card"><p>Purchase</p><h2 id="dBill">Rs. 0</h2></div>
 <div class="card"><p>Paid</p><h2 id="dPaid">Rs. 0</h2></div>
 <div class="card"><p>Pending</p><h2 id="dPending">Rs. 0</h2></div>
</div>

<div class="form-grid">
 <input id="supplier" placeholder="Supplier">
 <input id="bill" type="number" placeholder="Bill Amount (Rs.)">
 <input id="cash" type="number" placeholder="Cash" value="0">
 <input id="upi" type="number" placeholder="UPI" value="0">
 <input id="net" type="number" placeholder="Net Banking" value="0">
 <button onclick="saveEntry()">Save</button>
</div>

</div>

<!-- HISTORY -->
<div id="history" class="panel">

<div class="form-grid">
 <input id="fSupplier" placeholder="Filter Supplier">
 <input id="fromDate" type="date">
 <input id="toDate" type="date">
</div>

<div class="table-box">
<table>
<thead>
<tr>
<th>Date</th><th>Supplier</th><th>Bill</th><th>Paid</th><th>Pending</th>
</tr>
</thead>
<tbody id="historyRows"></tbody>
</table>
</div>

</div>

<!-- ANALYTICS -->
<div id="analytics" class="panel">

<!-- TREND -->
<div class="dashboard">
 <div class="card">
   <p>Month Trend</p>
   <h2 id="trendValue">—</h2>
 </div>
 <div class="card">
   <p>Forecast (Next Month)</p>
   <h2 id="forecastValue">Rs. —</h2>
 </div>
</div>

<div class="chart-box">
 <h3>Monthly Purchase Trend</h3>
 <canvas id="monthlyChart"></canvas>
</div>

<div class="chart-box">
 <h3>Payment Mode Split</h3>
 <canvas id="modeChart"></canvas>
</div>

</div>

</div>

<script>
let data=JSON.parse(localStorage.getItem("purchase_data"))||[];
const today=new Date().toISOString().split("T")[0];

function save(){
 localStorage.setItem("purchase_data",JSON.stringify(data));
}

function saveEntry(){
 let e={
  supplier:supplier.value.trim(),
  bill:+bill.value,
  cash:+cash.value,
  upi:+upi.value,
  net:+net.value,
  date:today
 };
 if(!e.supplier||!e.bill)return alert("Enter supplier & bill");
 if(e.cash+e.upi+e.net>e.bill)return alert("Paid exceeds bill");
 data.push(e);
 supplier.value=bill.value="";
 cash.value=upi.value=net.value=0;
 save();render();
}

function render(){
 let tb=0,tp=0;
 data.filter(e=>e.date===today).forEach(e=>{
  tb+=e.bill;
  tp+=e.cash+e.upi+e.net;
 });
 dBill.textContent="Rs. "+tb;
 dPaid.textContent="Rs. "+tp;
 dPending.textContent="Rs. "+(tb-tp);

 renderHistory();
 renderAnalytics();
 save();
}

function renderHistory(){
 historyRows.innerHTML="";
 data.filter(e=>{
  if(fSupplier.value&&!e.supplier.toLowerCase().includes(fSupplier.value.toLowerCase()))return false;
  if(fromDate.value&&e.date<fromDate.value)return false;
  if(toDate.value&&e.date>toDate.value)return false;
  return true;
 }).forEach(e=>{
  let paid=e.cash+e.upi+e.net;
  historyRows.innerHTML+=`
  <tr>
   <td>${e.date}</td>
   <td>${e.supplier}</td>
   <td>Rs. ${e.bill}</td>
   <td>Rs. ${paid}</td>
   <td>Rs. ${e.bill-paid}</td>
  </tr>`;
 });
}

let monthlyChart,modeChart;

function renderAnalytics(){
 let monthMap={}, cash=0,upi=0,net=0;

 data.forEach(e=>{
  let m=e.date.slice(0,7);
  monthMap[m]=(monthMap[m]||0)+e.bill;
  cash+=e.cash; upi+=e.upi; net+=e.net;
 });

 let months=Object.keys(monthMap).sort();
 let values=months.map(m=>monthMap[m]);

 // Trend
 if(months.length>=2){
  let last=values[values.length-1];
  let prev=values[values.length-2];
  let diff=((last-prev)/prev*100).toFixed(1);
  trendValue.textContent=(diff>=0?"↑ ":"↓ ")+Math.abs(diff)+"%";
  trendValue.className=diff>=0?"good":"bad";
 }

 // Forecast (last 3 months avg)
 let last3=values.slice(-3);
 let forecast=Math.round(last3.reduce((a,b)=>a+b,0)/last3.length||0);
 forecastValue.textContent="Rs. "+forecast;

 // Monthly Chart
 if(monthlyChart) monthlyChart.destroy();
 monthlyChart=new Chart(document.getElementById("monthlyChart"),{
  type:"bar",
  data:{labels:months,datasets:[{label:"Rs. Purchase",data:values,backgroundColor:"#3b82f6"}]}
 });

 // Payment Mode Chart
 if(modeChart) modeChart.destroy();
 modeChart=new Chart(document.getElementById("modeChart"),{
  type:"doughnut",
  data:{
   labels:["Cash","UPI","Net Banking"],
   datasets:[{data:[cash,upi,net],backgroundColor:["#22c55e","#3b82f6","#8b5cf6"]}]
  }
 });
}

function openTab(id){
 document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
 document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 event.target.classList.add("active");
}

render();
</script>

</body>
</html>
