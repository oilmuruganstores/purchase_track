<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Oil Murugan Stores | Ledger</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Segoe UI",sans-serif;
  background:linear-gradient(180deg,#f5f7fa,#e4e8ee);
  color:#111;
}
.app{max-width:1400px;margin:auto;padding:28px}

/* HEADER */
.header{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:24px
}
.header h1{margin:0;font-weight:700}
.header span{color:#666}

/* TABS */
.tabs{display:flex;gap:10px;margin-bottom:20px}
.tab{
  padding:10px 18px;border-radius:999px;
  background:#fff;border:1px solid #ddd;
  cursor:pointer;font-weight:600
}
.tab.active{
  background:#111;color:#fff
}

/* PANELS */
.panel{display:none}
.panel.active{display:block}

/* CARDS */
.card{
  background:#fff;border-radius:18px;padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  margin-bottom:20px
}

/* FORM */
.form{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:12px
}
input,select,button{
  padding:12px 14px;border-radius:12px;border:1px solid #ddd;
  font-size:14px
}
button{
  background:#111;color:#fff;font-weight:700;border:none;cursor:pointer
}

/* TABLE */
table{width:100%;border-collapse:collapse}
th{
  text-align:left;padding:14px;border-bottom:1px solid #eee;
  color:#666;font-size:13px
}
td{padding:14px;border-bottom:1px solid #f1f1f1}
tr:hover{background:#fafafa}

/* STATUS */
.green{color:#0f766e;font-weight:700}
.red{color:#b91c1c;font-weight:700}

/* LEDGER */
.ledger-row{display:flex;justify-content:space-between;padding:10px 0}

/* INSIGHTS */
.insight{padding:10px 0;font-weight:600}
</style>
</head>

<body>
<div class="app">

<div class="header">
  <h1>Oil Murugan Stores</h1>
  <span>Purchase & Ledger System</span>
</div>

<div class="tabs">
  <div class="tab active" onclick="openTab('today')">Today</div>
  <div class="tab" onclick="openTab('ledger')">Supplier Ledger</div>
  <div class="tab" onclick="openTab('audit')">Audit Log</div>
  <div class="tab" onclick="openTab('insights')">Insights</div>
</div>

<!-- TODAY -->
<div id="today" class="panel active">

<div class="card">
  <div class="form">
    <input id="supplier" placeholder="Supplier">
    <input id="bill" type="number" placeholder="Bill">
    <input id="cash" type="number" placeholder="Cash" value="0">
    <input id="upi" type="number" placeholder="UPI" value="0">
    <input id="net" type="number" placeholder="Net Banking" value="0">
    <button onclick="addPurchase()">Add Purchase</button>
  </div>
</div>

<div class="card">
<table>
<thead>
<tr><th>Supplier</th><th>Bill</th><th>Paid</th><th>Pending</th></tr>
</thead>
<tbody id="todayRows"></tbody>
</table>
</div>

</div>

<!-- LEDGER -->
<div id="ledger" class="panel">
<div class="card">
  <select id="ledgerSupplier" onchange="renderLedger()"></select>
  <div id="ledgerView"></div>
</div>
</div>

<!-- AUDIT -->
<div id="audit" class="panel">
<div class="card">
<table>
<thead><tr><th>Time</th><th>Action</th><th>Details</th></tr></thead>
<tbody id="auditRows"></tbody>
</table>
</div>
</div>

<!-- INSIGHTS -->
<div id="insights" class="panel">
<div class="card" id="insightBox"></div>
</div>

</div>

<script>
const today=new Date().toISOString().split("T")[0];
let data=JSON.parse(localStorage.getItem("oms_data"))||[];
let audit=JSON.parse(localStorage.getItem("oms_audit"))||[];
let opening=JSON.parse(localStorage.getItem("oms_opening"))||{};

function paid(e){return (e.cash||0)+(e.upi||0)+(e.net||0)}
function save(){
 localStorage.setItem("oms_data",JSON.stringify(data));
 localStorage.setItem("oms_audit",JSON.stringify(audit));
 localStorage.setItem("oms_opening",JSON.stringify(opening));
}

function addPurchase(){
 let e={
  supplier:supplier.value.trim(),
  bill:+bill.value,
  cash:+cash.value,
  upi:+upi.value,
  net:+net.value,
  date:today
 };
 if(!e.supplier||!e.bill) return;
 data.push(e);
 audit.push({time:new Date().toLocaleString(),action:"ADD",detail:e.supplier+" bill "+e.bill});
 supplier.value=bill.value="";
 cash.value=upi.value=net.value=0;
 save();render();
}

function render(){
 todayRows.innerHTML="";
 let supSet=new Set();
 data.forEach(e=>{
  supSet.add(e.supplier);
  let p=paid(e),pend=e.bill-p;
  todayRows.innerHTML+=`
  <tr>
   <td>${e.supplier}</td>
   <td>${e.bill}</td>
   <td>${p}</td>
   <td class="${pend>0?'red':'green'}">${pend}</td>
  </tr>`;
 });
 ledgerSupplier.innerHTML="";
 [...supSet].forEach(s=>ledgerSupplier.innerHTML+=`<option>${s}</option>`);
 renderLedger();
 renderAudit();
 renderInsights();
}

function renderLedger(){
 let s=ledgerSupplier.value;
 if(!s) return;
 let bal=opening[s]||0;
 let html=`<div class="ledger-row"><b>Opening Balance</b><b>${bal}</b></div>`;
 data.filter(e=>e.supplier===s).forEach(e=>{
  bal+=e.bill-paid(e);
  html+=`<div class="ledger-row">
   <span>${e.date}</span>
   <span>${bal}</span>
  </div>`;
 });
 ledgerView.innerHTML=html;
}

function renderAudit(){
 auditRows.innerHTML="";
 audit.slice().reverse().forEach(a=>{
  auditRows.innerHTML+=`
  <tr><td>${a.time}</td><td>${a.action}</td><td>${a.detail}</td></tr>`;
 });
}

function renderInsights(){
 let total=data.reduce((s,e)=>s+e.bill,0);
 let avg=Math.round(total/(data.length||1));
 insightBox.innerHTML=`
 <div class="insight">üìä Avg Bill: Rs. ${avg}</div>
 <div class="insight">‚ö†Ô∏è High activity suppliers detected</div>
 <div class="insight">üí° Consider shifting cash to UPI</div>`;
}

function openTab(id){
 document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
 document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 event.target.classList.add("active");
}

render();
</script>

</body>
</html>
