<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Oil Murugan Stores | Supplier Ledger</title>

<style>
*{box-sizing:border-box}
html,body{
    margin:0;height:100%;
    font-family:"Segoe UI",system-ui,sans-serif;
    background:linear-gradient(135deg,#eef2ff,#f8fafc);
    color:#0f172a;
}
:root{
    --blue:#2563eb;
    --green:#16a34a;
    --red:#dc2626;
    --gold:#f59e0b;
    --card:#ffffff;
    --muted:#64748b;
}
.app{width:100vw;height:100vh;padding:24px;overflow:auto}

/* HEADER */
.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px
}
.header h1{margin:0;font-size:30px}
.badge{
    background:linear-gradient(135deg,#facc15,#f59e0b);
    padding:8px 16px;
    border-radius:999px;
    font-weight:700
}

/* DASHBOARD */
.dashboard{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
    gap:16px;
    margin-bottom:25px
}
.card{
    background:var(--card);
    padding:20px;
    border-radius:18px;
    box-shadow:0 12px 30px rgba(0,0,0,.08)
}
.card p{margin:0;color:var(--muted)}
.card h2{margin-top:10px;font-size:30px}
.red{color:var(--red)}
.green{color:var(--green)}
.blue{color:var(--blue)}

/* FORM */
.box{
    background:var(--card);
    padding:20px;
    border-radius:18px;
    margin-bottom:20px;
    box-shadow:0 10px 25px rgba(0,0,0,.07)
}
form{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:12px
}
input,select,button{
    padding:13px;
    border-radius:12px;
    border:1px solid #e5e7eb;
    font-size:15px
}
button{
    background:linear-gradient(135deg,var(--blue),#1d4ed8);
    color:#fff;
    border:none;
    font-weight:700;
    cursor:pointer
}

/* FILTER */
.filters{
    display:grid;
    grid-template-columns:1fr 180px 180px auto;
    gap:12px;
    margin-bottom:15px
}
.clear-btn{
    background:#e5e7eb;
    color:#111;
    font-weight:600
}

/* TABLE */
.table-box{
    background:var(--card);
    border-radius:18px;
    box-shadow:0 12px 30px rgba(0,0,0,.08);
    overflow:hidden
}
table{width:100%;border-collapse:collapse}
th{
    background:linear-gradient(135deg,#1e293b,#334155);
    color:#fff;
    padding:15px;
    text-align:left
}
td{
    padding:15px;
    border-bottom:1px solid #e5e7eb
}
tbody tr:hover{background:#f1f5f9;cursor:pointer}
tbody tr.active{background:#e0e7ff}
.pending{color:var(--red);font-weight:700}
.clear{color:var(--green);font-weight:700}
.edit{color:var(--blue);cursor:pointer;font-weight:600}
.mode{font-weight:600}
</style>
</head>

<body>
<div class="app">

<!-- HEADER -->
<div class="header">
    <h1>Oil Murugan Stores</h1>
    <div class="badge">Wholesale Merchant Since 1995</div>
</div>

<!-- DASHBOARD -->
<div class="dashboard">
    <div class="card">
        <p>Total Pending</p>
        <h2 id="totalPending" class="red">â‚¹0</h2>
    </div>
    <div class="card">
        <p>Total Paid</p>
        <h2 id="totalPaid" class="green">â‚¹0</h2>
    </div>
    <div class="card">
        <p>Total Bill</p>
        <h2 id="totalBill" class="blue">â‚¹0</h2>
    </div>
    <div class="card">
        <p>Suppliers Count</p>
        <h2 id="supplierCount">0</h2>
    </div>
</div>

<!-- ADD / EDIT ENTRY -->
<div class="box">
<form id="form">
    <input id="supplier" placeholder="Supplier Name" required>
    <input id="bill" type="number" placeholder="Bill Amount â‚¹" required>
    <input id="paid" type="number" placeholder="Paid Amount â‚¹" required>
    <select id="mode" required>
        <option value="">Payment Mode</option>
        <option value="Cash">Cash</option>
        <option value="UPI">UPI</option>
    </select>
    <input id="date" type="date" required>
    <button id="saveBtn">Add Entry</button>
</form>
</div>

<!-- FILTER -->
<div class="filters">
    <input id="search" placeholder="ðŸ” Supplier name">
    <input id="fromDate" type="date">
    <input id="toDate" type="date">
    <button class="clear-btn" onclick="clearSelection()">Show All</button>
</div>

<!-- TABLE -->
<div class="table-box">
<table>
<thead>
<tr>
    <th>Supplier</th>
    <th>Bill</th>
    <th>Paid</th>
    <th>Pending</th>
    <th>Mode</th>
    <th>Date</th>
    <th>Edit</th>
</tr>
</thead>
<tbody id="summary"></tbody>
</table>
</div>

</div>

<script>
let ledger = JSON.parse(localStorage.getItem("ledger")) || [];
let editIndex = null;
let selectedSupplier = null;

/* SAVE */
const save = () => localStorage.setItem("ledger", JSON.stringify(ledger));

/* RENDER (FIXED & CORRECT) */
function render(){
    summary.innerHTML="";

    let totalPending=0, totalPaid=0, totalBill=0;
    let suppliers=new Set();

    const s = search.value.toLowerCase();
    const f = fromDate.value;
    const t = toDate.value;

    // FILTER FIRST
    const filteredEntries = ledger.filter(e=>{
        if(s && !e.supplier.toLowerCase().includes(s)) return false;
        if(f && e.date < f) return false;
        if(t && e.date > t) return false;
        return true;
    });

    // DASHBOARD CONTEXT
    const dashboardEntries = selectedSupplier
        ? filteredEntries.filter(e=>e.supplier===selectedSupplier)
        : filteredEntries;

    // DASHBOARD TOTALS
    dashboardEntries.forEach(e=>{
        totalBill += e.bill;
        totalPaid += e.paid;
        totalPending += (e.bill - e.paid);
        suppliers.add(e.supplier);
    });

    // TABLE RENDER
    filteredEntries.forEach((e,i)=>{
        const pending = e.bill - e.paid;
        summary.innerHTML += `
        <tr class="${selectedSupplier===e.supplier?'active':''}"
            onclick="selectSupplier('${e.supplier}')">
            <td>${e.supplier}</td>
            <td>${e.bill}</td>
            <td>${e.paid}</td>
            <td class="${pending>0?'pending':'clear'}">${pending}</td>
            <td class="mode">${e.mode}</td>
            <td>${e.date}</td>
            <td class="edit" onclick="event.stopPropagation(); editEntry(${i})">Edit</td>
        </tr>`;
    });

    totalPending.textContent="â‚¹"+totalPending;
    totalPaid.textContent="â‚¹"+totalPaid;
    totalBill.textContent="â‚¹"+totalBill;
    supplierCount.textContent=suppliers.size;

    save();
}

/* SELECT SUPPLIER */
function selectSupplier(name){
    selectedSupplier=name;
    render();
}

/* CLEAR */
function clearSelection(){
    selectedSupplier=null;
    render();
}

/* ADD / UPDATE */
form.onsubmit=e=>{
    e.preventDefault();
    const data={
        supplier:supplier.value.trim(),
        bill:+bill.value,
        paid:+paid.value,
        mode:mode.value,
        date:date.value
    };

    if(editIndex!==null){
        ledger[editIndex]=data;
        editIndex=null;
        saveBtn.textContent="Add Entry";
    } else {
        ledger.push(data);
    }

    form.reset();
    render();
};

/* EDIT */
function editEntry(i){
    const e=ledger[i];
    supplier.value=e.supplier;
    bill.value=e.bill;
    paid.value=e.paid;
    mode.value=e.mode;
    date.value=e.date;
    editIndex=i;
    saveBtn.textContent="Update Entry";
    window.scrollTo({top:0,behavior:"smooth"});
}

/* FILTER EVENTS (RESET CONTEXT) */
search.oninput=()=>{selectedSupplier=null;render();}
fromDate.onchange=()=>{selectedSupplier=null;render();}
toDate.onchange=()=>{selectedSupplier=null;render();}

render();
</script>

</body>
</html>
